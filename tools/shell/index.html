<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Shell | Wiki</title>
    <meta name="description" content="零散知识整理">
    <link rel="icon" href="/img/light.jpg">
    
    <link rel="preload" href="/assets/css/0.styles.aa1abe57.css" as="style"><link rel="preload" href="/assets/js/app.2003e2e6.js" as="script"><link rel="preload" href="/assets/js/46.de984a51.js" as="script"><link rel="prefetch" href="/assets/js/10.5763f618.js"><link rel="prefetch" href="/assets/js/11.2f3ce2b1.js"><link rel="prefetch" href="/assets/js/12.55c116aa.js"><link rel="prefetch" href="/assets/js/13.eed944ff.js"><link rel="prefetch" href="/assets/js/14.bd0729af.js"><link rel="prefetch" href="/assets/js/15.37f99b73.js"><link rel="prefetch" href="/assets/js/16.468d4c4a.js"><link rel="prefetch" href="/assets/js/17.c20c8c56.js"><link rel="prefetch" href="/assets/js/18.ecca4895.js"><link rel="prefetch" href="/assets/js/19.35f456c4.js"><link rel="prefetch" href="/assets/js/2.39a72fe7.js"><link rel="prefetch" href="/assets/js/20.c0eb4e84.js"><link rel="prefetch" href="/assets/js/21.7e1f2a73.js"><link rel="prefetch" href="/assets/js/22.d80fc63d.js"><link rel="prefetch" href="/assets/js/23.d36069a1.js"><link rel="prefetch" href="/assets/js/24.72bb63d2.js"><link rel="prefetch" href="/assets/js/25.0ede43f8.js"><link rel="prefetch" href="/assets/js/26.cd4dd314.js"><link rel="prefetch" href="/assets/js/27.d2ad333e.js"><link rel="prefetch" href="/assets/js/28.400bb2d9.js"><link rel="prefetch" href="/assets/js/29.e963690e.js"><link rel="prefetch" href="/assets/js/3.0ad32081.js"><link rel="prefetch" href="/assets/js/30.8d9372ed.js"><link rel="prefetch" href="/assets/js/31.e0caa3b7.js"><link rel="prefetch" href="/assets/js/32.3afcf48f.js"><link rel="prefetch" href="/assets/js/33.4675369d.js"><link rel="prefetch" href="/assets/js/34.d14af7eb.js"><link rel="prefetch" href="/assets/js/35.a0e1ae76.js"><link rel="prefetch" href="/assets/js/36.1df218fb.js"><link rel="prefetch" href="/assets/js/37.f99a02f0.js"><link rel="prefetch" href="/assets/js/38.46c4d0eb.js"><link rel="prefetch" href="/assets/js/39.178154b6.js"><link rel="prefetch" href="/assets/js/4.d97b78b7.js"><link rel="prefetch" href="/assets/js/40.e032b61a.js"><link rel="prefetch" href="/assets/js/41.97998c86.js"><link rel="prefetch" href="/assets/js/42.a896e0e2.js"><link rel="prefetch" href="/assets/js/43.7c386363.js"><link rel="prefetch" href="/assets/js/44.c24a1b88.js"><link rel="prefetch" href="/assets/js/45.40ee9467.js"><link rel="prefetch" href="/assets/js/47.661cccb6.js"><link rel="prefetch" href="/assets/js/48.957fe889.js"><link rel="prefetch" href="/assets/js/49.89ddebc4.js"><link rel="prefetch" href="/assets/js/5.3344f2f8.js"><link rel="prefetch" href="/assets/js/50.cb5f4b0f.js"><link rel="prefetch" href="/assets/js/51.9b928e8f.js"><link rel="prefetch" href="/assets/js/52.8a432e94.js"><link rel="prefetch" href="/assets/js/53.22af6352.js"><link rel="prefetch" href="/assets/js/6.6dad0a2d.js"><link rel="prefetch" href="/assets/js/7.f633ea00.js"><link rel="prefetch" href="/assets/js/8.0c185add.js"><link rel="prefetch" href="/assets/js/9.2f7dba1d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.aa1abe57.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Wiki</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/languages/python/" class="nav-link">编程语言</a></div><div class="nav-item"><a href="/systems/linux/" class="nav-link">操作系统</a></div><div class="nav-item"><a href="/tools/shell/" class="nav-link router-link-exact-active router-link-active">工具</a></div><div class="nav-item"><a href="/others/rubiks/" class="nav-link">其它</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/languages/python/" class="nav-link">编程语言</a></div><div class="nav-item"><a href="/systems/linux/" class="nav-link">操作系统</a></div><div class="nav-item"><a href="/tools/shell/" class="nav-link router-link-exact-active router-link-active">工具</a></div><div class="nav-item"><a href="/others/rubiks/" class="nav-link">其它</a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>GDB</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/gdb/" class="sidebar-link">GDB</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Git</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/git/" class="sidebar-link">Git</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>MySQL</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/mysql/" class="sidebar-link">MySQL</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Nginx</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/nginx/" class="sidebar-link">Nginx</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>sed</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/sed/" class="sidebar-link">sed</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>Shell</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/shell/" class="active sidebar-link">Shell</a></li><li><a href="/tools/shell/awesome-cli.html" class="sidebar-link">Awesome CLI</a></li><li><a href="/tools/shell/dd-speed-test.html" class="sidebar-link">磁盘读写压测</a></li><li><a href="/tools/shell/logrotate-examples.html" class="sidebar-link">logrotate 10例</a></li><li><a href="/tools/shell/samba.html" class="sidebar-link">samba</a></li><li><a href="/tools/shell/ssh-without-password.html" class="sidebar-link">SSH免密码</a></li><li><a href="/tools/shell/string-escape.html" class="sidebar-link">bash的字符串转义</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>tmux</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/tmux/" class="sidebar-link">tmux</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Vim</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/tools/vim/" class="sidebar-link">Vim</a></li><li><a href="/tools/vim/vim-current-env.html" class="sidebar-link">显示vim当前环境变量</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="shell"><a href="#shell" aria-hidden="true" class="header-anchor">#</a> Shell</h1> <ul><li>发现find的-print0配上xargs -0不错</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token function">find</span> <span class="token keyword">.</span> -name <span class="token string">&quot;*.cpp&quot;</span> -print0 <span class="token operator">|</span> <span class="token function">xargs</span> -0 <span class="token function">grep</span> hello
</code></pre></div><p>当然上面也可以这么写</p> <div class="language-bash extra-class"><pre class="language-bash"><code>    <span class="token function">find</span> <span class="token keyword">.</span> name <span class="token string">&quot;*.cpp&quot;</span> -exec <span class="token function">grep</span> hello <span class="token punctuation">{</span><span class="token punctuation">}</span> \<span class="token punctuation">;</span>
</code></pre></div><ul><li><p>在脚本里可以用$PPID来获取父进程pid</p></li> <li><p><code>netstat -t</code>里有Recv-Q Send-Q，可以查看tcp的发送和接收缓存</p></li> <li><p><code>netstat –tlp</code> 列出本机进程监听的端口号。（陈皓注：netstat -anop 可以显示侦听在这个端口号的进程）</p></li> <li><p><code>ps -p PID -o lstart,cmd</code> 可以查看进程启动时间</p></li> <li><p>grep多行结果：<code>grep -A3 pat filename</code>，显示匹配行后3行，<code>grep -B3 pat filename</code>，显示匹配行前3行，<code>grep -C3 pat filename</code>，显示分别显示前后3行</p></li> <li><p><code>grep -a</code>搜索二进制文件</p></li> <li><p>compgen 用法</p></li></ul> <table><thead><tr><th>命令</th> <th>说明</th></tr></thead> <tbody><tr><td>compgen -c</td> <td>will list all the commands you could run.</td></tr> <tr><td>compgen -a</td> <td>will list all the aliases you could run.</td></tr> <tr><td>compgen -b</td> <td>will list all the built-ins you could run.</td></tr> <tr><td>compgen -k</td> <td>will list all the keywords you could run.</td></tr> <tr><td>compgen -A</td> <td>function will list all the functions you could run.</td></tr> <tr><td>compgen -A</td> <td>function -abck will list all the above in one go.</td></tr></tbody></table> <ul><li><p><code>pstree -p</code></p></li> <li><p><code>pkill -f</code>, <code>pgrep -f</code></p></li> <li><p><code>ctrl + R</code>搜索输入过的命令</p></li> <li><p><code>uniq -u</code>，only print unique line; uniq -d, only print duplicate lines</p></li> <li><p>xargs -I 'replace-str' echo 'replace-str is an argument'</p></li> <li><p><code>bash -n script-filename</code> 检查语法错误，<code>bash -x script-filename</code> 每运行一行输出一行，设置上 <code>export PS4='+{$LINENO:${FUNCNAME[0]}}</code> 每行输出时能输出行号跟函数名</p></li> <li><p><code>ls -i</code>，查看inode编号</p></li> <li><p><code>paste file1 file2</code>，合并列的方式合并file1, file2</p></li> <li><p><code>wait</code>是内部命令，wait %1或wait $PID来等待进程退出。没给参数就等待所有子进程</p></li> <li><p><code>var=10 ./echo_var.sh</code>，在程序echo_var.sh运行时，环境变量会多出一个var，值是10</p></li> <li><p>重新加载fstab</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">mount</span> -a
</code></pre></div><ul><li>screen使用</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">screen</span> -ls      <span class="token comment"># 显示screen列表</span>
<span class="token function">screen</span> -r 编号  <span class="token comment"># 恢复screen</span>
</code></pre></div><ul><li>根据inode删除文件</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ls</span> -i
<span class="token function">find</span> <span class="token keyword">.</span> -inum 782263 -exec <span class="token function">rm</span> -i <span class="token punctuation">{</span><span class="token punctuation">}</span> \<span class="token punctuation">;</span>
</code></pre></div><ul><li>查看线程数据的三种方法</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>1、top -H
<span class="token comment"># 手册中说：-H : Threads toggle</span>
<span class="token comment"># 加上这个选项启动top，top一行显示一个线程。否则，它一行显示一个进程。</span>

2、ps xH
<span class="token comment"># 手册中说：H Show threads as if they were processes</span>
<span class="token comment"># 这样可以查看所有存在的线程。</span>

3、ps -mp <span class="token operator">&lt;</span>PID<span class="token operator">&gt;</span>
<span class="token comment"># 手册中说：m Show threads after processes</span>
<span class="token comment"># 这样可以查看一个进程起的线程数。</span>
</code></pre></div><ul><li>新建用户</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">useradd</span> -s /bin/bash -m -d /home/lightxue -c <span class="token string">'lightxue'</span> -g root lightxue
</code></pre></div><ul><li>时区设置</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</code></pre></div><ul><li>时间同步</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>/usr/sbin/ntpdate us.pool.ntp.org <span class="token operator">|</span> logger -t NTP
</code></pre></div><ul><li>时区设置</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">sudo</span> <span class="token function">cp</span> /usr/share/zoneinfo/Asia/Shanghai /etc/localtime
</code></pre></div><ul><li>设备uuid</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>lsblk -o UUID /dev/sda1
</code></pre></div><ul><li><p>cp的两个参数：-p保留原来文件的owner, -P，如果是软连接，保持原样拷贝</p></li> <li><p>所谓的glob模式是指shell所使用的简化了的正则表达式。星号（*）匹配零个或多个任意字符；[abc]匹配任何一个列在方括号中的字符（这个例子要么匹配一个a，要么匹配一个b，要么匹配一个c）；问号（?）只匹配一个任意字符；如果在方括号中使用短划线分隔两个字符，表示所有在这两个字符范围内的都可以匹配（比如[0-9]表示匹配所有0 到 9 的数字）。</p></li> <li><p>删除但是进程还占用着的文件，由此可以找到对应的进程</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">lsof</span> <span class="token operator">|</span> <span class="token function">grep</span> deleted
</code></pre></div><ul><li><p>uptime开机时间</p></li> <li><p>文件名编码转换</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>convmv -f gbk -t utf-8 --notest -r <span class="token keyword">.</span>
</code></pre></div><ul><li>ipcs查看，ipcrm删除：共享内存、信号量、队列</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>convmv -f gbk -t utf-8 --notest -r <span class="token keyword">.</span>
</code></pre></div><ul><li>当前shell的pid</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token keyword">echo</span> $$
</code></pre></div><ul><li><p>tar把软链接指向的内容也包上，加上-h参数</p></li> <li><p>列出当前目录所有子目录</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">ls</span> -d */
<span class="token keyword">echo</span> */, <span class="token keyword">echo</span> */*/
</code></pre></div><ul><li>简单的计算器</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>calc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token function">awk</span> <span class="token string">&quot;BEGIN{ print <span class="token variable">$*</span>  }&quot;</span> <span class="token punctuation">;</span> <span class="token punctuation">}</span>
calc <span class="token string">&quot;8 * 99 / 4&quot;</span>
</code></pre></div><ul><li>下载整个网站</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">wget</span> --random-wait -r -p -e robots<span class="token operator">=</span>off -U mozilla http://www.example.com
</code></pre></div><ul><li>date命令相关</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 1381235068转成时间字符串，如果不指定格式，+'%Y-%m-%d %H:%M:%S'可以不要</span>
<span class="token function">date</span> -d @1381235068 +<span class="token string">'%Y-%m-%d %H:%M:%S'</span>
<span class="token comment"># '2013-10-08 20:24:28'转成时间戳</span>
<span class="token function">date</span> -d <span class="token string">'2013-10-08 20:24:28'</span> <span class="token string">'+%s'</span>
<span class="token comment"># 当前时间的时间戳</span>
<span class="token function">date</span> +%s
</code></pre></div><ul><li><p>watch命令可以周期性调用其他程序，全屏显示</p></li> <li><p>sudo刚开始出现的话，很有意思</p></li></ul> <blockquote><p>We trust you have received the usual lecture from the local System
Administrator. It usually boils down to these three things:</p> <pre><code>#1) Respect the privacy of others.
#2) Think before you type.
#3) With great power comes great responsibility.
</code></pre></blockquote> <ul><li>提示符</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">export</span> PS1<span class="token operator">=</span><span class="token string">&quot;\[\e[31;1m\]64bit_\[\e[31;1m\]\u\[\e[0m\]@\[\e[32;1m\]<span class="token variable"><span class="token variable">`</span>/sbin/ifconfig eth1<span class="token operator">|</span><span class="token function">grep</span> <span class="token string">&quot;inet addr:&quot;</span><span class="token operator">|</span><span class="token function">cut</span> -d: -f 2<span class="token operator">|</span><span class="token function">cut</span> -d<span class="token string">&quot; &quot;</span> -f1<span class="token variable">`</span></span>\[\e[0m\]:\[\e[35;1m\]\w\[\e[0m\]\\$ &quot;</span>
</code></pre></div><ul><li>软件连接最终指向的文件</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>readlink -f symbol-link-file-name
</code></pre></div><ul><li>本地语言修改</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">export</span> LC_ALL<span class="token operator">=</span>zh_CN.UTF-8
</code></pre></div><ul><li>当前脚本所在目录</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>cwd<span class="token operator">=</span><span class="token variable"><span class="token variable">$(</span><span class="token function">dirname</span> $<span class="token punctuation">{</span>BASH_SOURCE<span class="token punctuation">[</span>0<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token variable">)</span></span>
<span class="token keyword">echo</span> <span class="token variable">$cwd</span>
</code></pre></div><ul><li><p>excect脚本如果不是交互下运行，最后不能用<code>interact</code>，要用<code>expect eof</code></p></li> <li><p>top显示单个进程信息</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">top</span> -p <span class="token variable"><span class="token variable">`</span>pgrep process-name <span class="token operator">|</span> <span class="token function">tr</span> <span class="token string">&quot;\\n&quot;</span> <span class="token string">&quot;,&quot;</span> <span class="token operator">|</span> <span class="token function">sed</span> <span class="token string">'s/,$//'</span><span class="token variable">`</span></span>
</code></pre></div><ul><li>用python实现<code>urldecode</code>和<code>urlencode</code>命令</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">alias</span> urldecode<span class="token operator">=</span><span class="token string">'python -c &quot;import sys, urllib as ul; \
    print ul.unquote_plus(sys.argv[1])&quot;'</span>

$ <span class="token function">alias</span> urlencode<span class="token operator">=</span><span class="token string">'python -c &quot;import sys, urllib as ul; \
    print ul.quote_plus(sys.argv[1])&quot;'</span>
</code></pre></div><ul><li>删除第一行</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">tail</span> -n +2 <span class="token string">&quot;<span class="token variable">$FILE</span>&quot;</span>
</code></pre></div><ul><li>多行字符串</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">read</span> -r -d <span class="token string">''</span> MULTILINE <span class="token operator">&lt;&lt;</span> <span class="token string">EOM
one
two
three
EOM</span>
</code></pre></div><ul><li><p><code>whence</code>可以查看<code>alias</code>的定义</p></li> <li><p>给用户增加sudo权限</p></li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 方法1</span>
<span class="token function">sudo</span> <span class="token function">usermod</span> -aG <span class="token function">sudo</span> lightxue
<span class="token comment"># 方法2</span>
<span class="token function">sudo</span> <span class="token function">vi</span> /etc/sudoers
</code></pre></div><ul><li>改变<code>ls</code>的默认颜色</li></ul> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">dircolors</span> -p <span class="token operator">&gt;</span> ~/.dircolors
<span class="token comment"># 修改~/.dircolors</span>
<span class="token comment"># ~/.bashrc加上下面代码</span>
<span class="token punctuation">[</span> -e ~/.dircolors  <span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span> <span class="token function">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">dircolors</span> -b ~/.dircolors<span class="token variable">)</span></span> <span class="token operator">||</span> <span class="token function">eval</span> <span class="token variable"><span class="token variable">$(</span><span class="token function">dircolors</span> -b<span class="token variable">)</span></span>
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/tools/sed/" class="prev">
          sed
        </a></span> <span class="next"><a href="/tools/shell/awesome-cli.html">
          Awesome CLI
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/46.de984a51.js" defer></script><script src="/assets/js/app.2003e2e6.js" defer></script>
  </body>
</html>
