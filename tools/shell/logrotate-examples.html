
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>logrotate示例 · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.2">
        
        
        
    
    <link rel="stylesheet" href="../../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="ssh-without-password.html" />
    
    
    <link rel="prev" href="string-escape.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../../">
            
                <a href="../../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Language</li>
        
        
    
        <li class="chapter " data-level="2.1" data-path="../../language/python/">
            
                <a href="../../language/python/">
            
                    
                    Python
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="2.2" data-path="../../language/c-cpp/">
            
                <a href="../../language/c-cpp/">
            
                    
                    C/C++
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">System</li>
        
        
    
        <li class="chapter " data-level="3.1" data-path="../../system/linux/">
            
                <a href="../../system/linux/">
            
                    
                    Linux
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="3.1.1" data-path="../../system/linux/coredump.html">
            
                <a href="../../system/linux/coredump.html">
            
                    
                    coredump
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.2" data-path="../../system/linux/epoll-intro.html">
            
                <a href="../../system/linux/epoll-intro.html">
            
                    
                    epool初步
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.3" data-path="../../system/linux/fight-with-garbled-characters.html">
            
                <a href="../../system/linux/fight-with-garbled-characters.html">
            
                    
                    乱码
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.4" data-path="../../system/linux/linux-performance-note.html">
            
                <a href="../../system/linux/linux-performance-note.html">
            
                    
                    linux性能
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.1.5" data-path="../../system/linux/thinking-in-epoll.html">
            
                <a href="../../system/linux/thinking-in-epoll.html">
            
                    
                    epoll
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="3.2" data-path="../../system/mac/">
            
                <a href="../../system/mac/">
            
                    
                    Mac OS X
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="3.3" data-path="../../system/windows/">
            
                <a href="../../system/windows/">
            
                    
                    Windows
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Tools</li>
        
        
    
        <li class="chapter " data-level="4.1" data-path="./">
            
                <a href="./">
            
                    
                    shell
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.1.1" data-path="dd-speed-test.html">
            
                <a href="dd-speed-test.html">
            
                    
                    dd硬盘测试速度
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.2" data-path="string-escape.html">
            
                <a href="string-escape.html">
            
                    
                    bash的字符串转义
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="4.1.3" data-path="logrotate-examples.html">
            
                <a href="logrotate-examples.html">
            
                    
                    logrotate示例
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.4" data-path="ssh-without-password.html">
            
                <a href="ssh-without-password.html">
            
                    
                    ssh免密码登录
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.1.5" data-path="samba.html">
            
                <a href="samba.html">
            
                    
                    samba配置
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.2" data-path="../vim/">
            
                <a href="../vim/">
            
                    
                    Vim
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="4.2.1" data-path="../vim/vim-current-env.html">
            
                <a href="../vim/vim-current-env.html">
            
                    
                    环境变量
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="4.3" data-path="../awk.html">
            
                <a href="../awk.html">
            
                    
                    AWK
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.4" data-path="../gdb.html">
            
                <a href="../gdb.html">
            
                    
                    GDB
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.5" data-path="../git.html">
            
                <a href="../git.html">
            
                    
                    Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.6" data-path="../mysql.html">
            
                <a href="../mysql.html">
            
                    
                    MySQL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.7" data-path="../nginx.html">
            
                <a href="../nginx.html">
            
                    
                    Nginx
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.8" data-path="../sed.html">
            
                <a href="../sed.html">
            
                    
                    sed
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="4.9" data-path="../tmux.html">
            
                <a href="../tmux.html">
            
                    
                    tmux
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Rubik</li>
        
        
    
        <li class="chapter " data-level="5.1" data-path="../../rubik/">
            
                <a href="../../rubik/">
            
                    
                    通用转法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.2" data-path="../../rubik/gan.html">
            
                <a href="../../rubik/gan.html">
            
                    
                    gan转法
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.3" data-path="../../rubik/oll.html">
            
                <a href="../../rubik/oll.html">
            
                    
                    OLL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.4" data-path="../../rubik/pll.html">
            
                <a href="../../rubik/pll.html">
            
                    
                    PLL
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.5" data-path="../../rubik/mini-cube.html">
            
                <a href="../../rubik/mini-cube.html">
            
                    
                    二阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.6" data-path="../../rubik/revenge.html">
            
                <a href="../../rubik/revenge.html">
            
                    
                    四阶
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="5.7" data-path="../../rubik/2x2x3-cube.html">
            
                <a href="../../rubik/2x2x3-cube.html">
            
                    
                    2x2x3
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Books</li>
        
        
    
        <li class="chapter " data-level="6.1" data-path="../../books/what-did-philosophers-do.html">
            
                <a href="../../books/what-did-philosophers-do.html">
            
                    
                    哲学家们都干了些什么
            
                </a>
            

            
        </li>
    

    
        
        <li class="header">Other</li>
        
        
    
        <li class="chapter " data-level="7.1" data-path="../../other/ascii-art.html">
            
                <a href="../../other/ascii-art.html">
            
                    
                    Ascii art
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="7.2" data-path="../../other/theory.html">
            
                <a href="../../other/theory.html">
            
                    
                    理论模型
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="../.." >logrotate示例</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="logrotate-10&#x4F8B;">logrotate 10&#x4F8B;</h1>
<p>&#x8F6C;&#x81EA; <a href="http://www.thegeekstuff.com/2010/07/logrotate-examples/" target="_blank">http://www.thegeekstuff.com/2010/07/logrotate-examples/</a></p>
<p>Managing log files effectively is an essential task for Linux sysadmin.</p>
<p>In this article, let us discuss how to perform following log file operations using UNIX logrotate utility.</p>
<ul>
<li>Rotate the log file when file size reaches a specific size</li>
<li>Continue to write the log information to the newly created file after rotating the old log file</li>
<li>Compress the rotated log files</li>
<li>Specify compression option for the rotated log files</li>
<li>Rotate the old log files with the date in the filename</li>
<li>Execute custom shell scripts immediately after log rotation</li>
<li>Remove older rotated log files</li>
</ul>
<h2 id="1-logrotate-configuration-files">1. Logrotate Configuration files</h2>
<p>Following are the key files that you should be aware of for logrotate to work properly.</p>
<p><code>/usr/sbin/logrotate</code> &#x2013; The logrotate command itself.</p>
<p><code>/etc/cron.daily/logrotate</code> &#x2013; This shell script executes the logrotate command everyday.</p>
<pre><code class="lang-sh">$ cat /etc/cron.daily/logrotate
<span class="hljs-meta">#!/bin/sh
</span>
/usr/sbin/logrotate /etc/logrotate.conf
EXITVALUE=$?
<span class="hljs-keyword">if</span> [ <span class="hljs-variable">$EXITVALUE</span> != 0 ]; <span class="hljs-keyword">then</span>
    /usr/bin/logger -t logrotate <span class="hljs-string">&quot;ALERT exited abnormally with [<span class="hljs-variable">$EXITVALUE</span>]&quot;</span>
<span class="hljs-keyword">fi</span>
<span class="hljs-built_in">exit</span> 0
</code></pre>
<p><code>/etc/logrotate.conf</code> &#x2013; Log rotation configuration for all the log files are specified in this file.</p>
<pre><code class="lang-sh">$ cat /etc/logrotate.conf
weekly
rotate 4
create
include /etc/logrotate.d
/var/<span class="hljs-built_in">log</span>/wtmp {
    monthly
    minsize 1M
    create 0664 root utmp
    rotate 1
}
</code></pre>
<p><code>/etc/logrotate.d</code> &#x2013; When individual packages are installed on the system, they drop the log rotation configuration information in this directory. For example, yum log rotate configuration information is shown below.</p>
<pre><code class="lang-sh">$ cat /etc/logrotate.d/yum
/var/<span class="hljs-built_in">log</span>/yum.log {
    missingok
    notifempty
    size 30k
    yearly
    create 0600 root root
}
</code></pre>
<h2 id="2-logrotate-size-option-rotate-the-log-file-when-file-size-reaches-a-specific-limit">2. Logrotate size option: Rotate the log file when file size reaches a specific limit</h2>
<p>If you want to rotate a log file (for example, /tmp/output.log) for every 1KB, create the logrotate.conf as shown below.</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        size 1k
        create 700 bala bala
        rotate 4
}
</code></pre>
<p>This logrotate configuration has following three options:</p>
<ul>
<li>size 1k &#x2013; logrotate runs only if the filesize is equal to (or greater than) this size.</li>
<li>create &#x2013; rotate the original file and create the new file with specified permission, user and group.</li>
<li>rotate &#x2013; limits the number of log file rotation. So, this would keep only the recent 4 rotated log files.</li>
</ul>
<p>Before the logrotation, following is the size of the output.log:</p>
<pre><code class="lang-sh">$ ls <span class="hljs-_">-l</span> /tmp/output.log
-rw-r--r-- 1 bala bala 25868 2010-06-09 21:19 /tmp/output.log
</code></pre>
<p>Now, run the logrotate command as shown below. Option -s specifies the filename to write the logrotate status.</p>
<pre><code class="lang-sh">$ logrotate <span class="hljs-_">-s</span> /var/<span class="hljs-built_in">log</span>/logstatus logrotate.conf
</code></pre>
<p>Note : whenever you need of log rotation for some files, prepare the logrotate configuration and run the logroate command manually.
After the logrotation, following is the size of the output.log:</p>
<pre><code class="lang-sh">$ ls <span class="hljs-_">-l</span> /tmp/output*
-rw-r--r--  1 bala bala 25868 2010-06-09 21:20 output.log.1
-rwx------ 1 bala bala        0 2010-06-09 21:20 output.log
</code></pre>
<p>Eventually this will keep following setup of rotated log files.</p>
<ul>
<li>output.log.4.</li>
<li>output.log.3</li>
<li>output.log.2</li>
<li>output.log.1</li>
<li>output.log</li>
</ul>
<p>Please remember that after the log rotation, the log file corresponds to the service would still point to rotated file (output.log.1) and keeps on writing in it. You can use the above method, if you want to rotate the apache <code>access_log</code> or <code>error_log</code> every 5 MB.</p>
<p>Ideally, you should modify the /etc/logrotate.conf to specify the logrotate information for a specific log file.</p>
<p>Also, if you are having huge log files, you can use: 10 Awesome Examples for Viewing Huge Log Files in Unix</p>
<h2 id="3-logrotate-copytruncate-option-continue-to-write-the-log-information-in-the-newly-created-file-after-rotating-the-old-log-file">3. Logrotate copytruncate option: Continue to write the log information in the newly created file after rotating the old log file.</h2>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
         size 1k
         copytruncate
         rotate 4
}
</code></pre>
<p>copytruncate instruct logrotate to creates the copy of the original file (i.e rotate the original log file) and truncates the original file to zero byte size. This helps the respective service that belongs to that log file can write to the proper file.</p>
<p>While manipulating log files, you might find the sed substitute, sed delete tips helpful.</p>
<h2 id="4-logrotate-compress-option-compress-the-rotated-log-files">4. Logrotate compress option: Compress the rotated log files</h2>
<p>If you use the compress option as shown below, the rotated files will be compressed with gzip utility.</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        size 1k
        copytruncate
        create 700 bala bala
        rotate 4
        compress
}
</code></pre>
<p>Output of compressed log file:</p>
<pre><code class="lang-sh">$ ls /tmp/output*
output.log.1.gz output.log
</code></pre>
<h2 id="5-logrotate-dateext-option-rotate-the-old-log-file-with-date-in-the-log-filename">5. Logrotate dateext option: Rotate the old log file with date in the log filename</h2>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        size 1k
        copytruncate
        create 700 bala bala
        dateext
        rotate 4
        compress
}
</code></pre>
<p>After the above configuration, you&#x2019;ll notice the date in the rotated log file as shown below.</p>
<pre><code class="lang-sh">$ ls -lrt /tmp/output*
-rw-r--r--  1 bala bala 8980 2010-06-09 22:10 output.log-20100609.gz
-rwxrwxrwx 1 bala bala     0 2010-06-09 22:11 output.log
</code></pre>
<p>This would work only once in a day. Because when it tries to rotate next time on the same day, earlier rotated file will be having the same filename. So, the logrotate wont be successful after the first run on the same day.</p>
<p>Typically you might use tail -f to view the output of the log file in realtime. You can even combine multiple tail -f output and display it on single terminal.</p>
<h2 id="6-logrotate-monthly-daily-weekly-option-rotate-the-log-file-weeklydailymonthly">6. Logrotate monthly, daily, weekly option: Rotate the log file weekly/daily/monthly</h2>
<p>For doing the rotation monthly once,</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        monthly
        copytruncate
        rotate 4
        compress
}
</code></pre>
<p>Add the weekly keyword as shown below for weekly log rotation.</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        weekly
        copytruncate
        rotate 4
        compress
}
</code></pre>
<p>Add the daily keyword as shown below for every day log rotation. You can also rotate logs hourly.</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        daily
        copytruncate
        rotate 4
        compress
}
</code></pre>
<h2 id="7-logrotate-postrotate-endscript-option-run-custom-shell-scripts-immediately-after-log-rotation">7. Logrotate postrotate endscript option: Run custom shell scripts immediately after log rotation</h2>
<p>Logrotate allows you to run your own custom shell scripts after it completes the log file rotation. The following configuration indicates that it will execute myscript.sh after the logrotation.</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        size 1k
        copytruncate
        rotate 4
        compress
        postrotate
               /home/bala/myscript.sh
        endscript
}
</code></pre>
<h2 id="8-logrotate-maxage-option-remove-older-rotated-log-files">8. Logrotate maxage option: Remove older rotated log files</h2>
<p>Logrotate automatically removes the rotated files after a specific number of days.  The following example indicates that the rotated log files would be removed after 100 days.</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        size 1k
        copytruncate
        rotate 4
        compress
        maxage 100
}
</code></pre>
<h2 id="9-logrotate-missingok-option-dont-return-error-if-the-log-file-is-missing">9. Logrotate missingok option: Dont return error if the log file is missing</h2>
<p>You can ignore the error message when the actual file is not available by using this option as shown below.</p>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        size 1k
        copytruncate
        rotate 4
        compress
        missingok
}
</code></pre>
<h2 id="10-logrotate-compresscmd-and-compressext-option-sspecify-compression-command-for-the-log-file-rotation">10. Logrotate compresscmd and compressext option: Sspecify compression command for the log file rotation</h2>
<pre><code class="lang-sh">$ cat logrotate.conf
/tmp/output.log {
        size 1k
        copytruncate
        create
        compress
        compresscmd /bin/bzip2
        compressext .bz2
        rotate 4
}
</code></pre>
<p>Following compression options are specified above:</p>
<ul>
<li>compress &#x2013; Indicates that compression should be done.</li>
<li>compresscmd &#x2013; Specify what type of compression command should be used. For example: /bin/bzip2</li>
<li>compressext &#x2013; Specify the extension on the rotated log file. Without this option, the rotated file would have the default extension as .gz. So, if you use bzip2 compressioncmd, specify the extension as .bz2 as shown in the above example.&#x5165;&#x95E8;10&#x4F8B;</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="string-escape.html" class="navigation navigation-prev " aria-label="Previous page: bash的字符串转义">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="ssh-without-password.html" class="navigation navigation-next " aria-label="Next page: ssh免密码登录">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"logrotate示例","level":"4.1.3","depth":2,"next":{"title":"ssh免密码登录","level":"4.1.4","depth":2,"path":"tools/shell/ssh-without-password.md","ref":"tools/shell/ssh-without-password.md","articles":[]},"previous":{"title":"bash的字符串转义","level":"4.1.2","depth":2,"path":"tools/shell/string-escape.md","ref":"tools/shell/string-escape.md","articles":[]},"dir":"ltr"},"config":{"plugins":[],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"highlight":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"gitbook":"*"},"file":{"path":"tools/shell/logrotate-examples.md","mtime":"2017-08-15T01:51:50.322Z","type":"markdown"},"gitbook":{"version":"3.2.2","time":"2018-04-04T19:14:13.789Z"},"basePath":"../..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../../gitbook/gitbook.js"></script>
    <script src="../../gitbook/theme.js"></script>
    
        
        <script src="../../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

